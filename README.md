# dedao-dl

> 🦉 用 go 写的一个 《得到》 APP 课程下载工具，使用 cookie 登录后，可在终端查看已购买的课程，听书书架，电子书架，锦囊，推荐话题等

![GitHub go.mod Go version](https://img.shields.io/github/go-mod/go-version/yann0917/dedao-dl)

## 特别声明

仅供个人学习使用，请尊重版权，内容版权均为得到所有，请勿传播内容！！！

仅供个人学习使用，请尊重版权，内容版权均为得到所有，请勿传播内容！！！

仅供个人学习使用，请尊重版权，内容版权均为得到所有，请勿传播内容！！！

## 特性

> 为了减少请求接口的频率，做了本地缓存，有效期一个小时，如果想看到最新购买的内容，可以手动删除当前目录下的 `.cache` 目录

* 可查看**购买**的课程，课程文章内容
* 可查看听书书架，电子书架列表
* 可查看已购买的锦囊
* 可查看知识城邦推荐话题精选内容
* 课程可生成PDF，也可生成 mp3 文件
* 每天听本书可下载音频
* 可切换登录账号

## 安装

### 安装依赖

* chromedp
  > 生成 PDF 需要借助 [chromedp](https://github.com/chromedp/chromedp), 该功能必须安装 [Google-Chrome](https://www.google.cn/intl/zh-CN/chrome/) 浏览器
* ffmpeg
  > 音频需要借助 [ffmpeg](https://ffmpeg.org/) 合成
  >
  >说明: 代码里集成了 u3m8 下载器，会导致编译后程序体积增大 7MB 左右，如果不想安装 ffmpeg， 请打开相关代码的注释即可。

### 使用 `go get` 安装

使用如下命令安装：

`go get -u github.com/yann0917/dedao-dl`

### 使用 Docker 运行

> 为了加快 build 速度，`alpine` 镜像源已修改为阿里镜像。

如果不想在本地安装 `ffmpeg` 和 `chromedp` 则提供了 `docker` 环境，参考以下命令构建并使用容器执行相关命令。

```bash
# build
docker build https://github.com/yann0917/dedao-dl.git#main -t dedao

# 登录
docker run -v `pwd`/config.json:/app/config.json -it --rm dedao login -c "CookieString placeholder"

docker run -v `pwd`/config.json:/app/config.json -it --rm dedao cat
# 查看课程
docker run -v `pwd`/config.json:/app/config.json -it --rm dedao course

# 下载课程
docker run -v `pwd`/output:/app/output -v `pwd`/config.json:/app/config.json -it --rm dedao dl xxx
# 下载每天听本书
docker run -v `pwd`/output:/app/output -v `pwd`/config.json:/app/config.json -it --rm dedao dlo xxx

```

#### 删除 `docker images` 中为 `none` 的镜像

```bash
docker ps -a | grep "Exited" | awk '{print $1 }'|xargs docker stop
docker ps -a | grep "Exited" | awk '{print $1 }'|xargs docker rm
docker images|grep none|awk '{print $3 }'|xargs docker rmi
```

## 使用方法

* 电脑端登录 [得到](https://www.dedao.cn)，以便生成 cookie ☆☆☆☆☆

`dedao-dl -h` 可查看帮助说明，每个命令都有 `-h` 参数可查看该命令的用法

```bash
Usage:
  dedao-dl [command]

Available Commands:
  ace         获取我的锦囊
  article     获取文章详情
  cat         获取课程分类
  course      获取我购买过课程
  dl          下载已购买课程, 并转换成 PDF & 音频
  dlo         下载每天听本书音频
  ebook       获取我的电子书架
  help        Help about any command
  login       登录得到 pc 端 https://www.dedao.cn
  odob        获取我的听书书架
  su          切换登录账号
  topic       获取推荐话题列表
  users       查看登录过的用户列表
  who         查看当前登录的用户
```

`dedao-dl login` 登录，不带任何参数的情况下，默认使用 [`go-rod/rod`](https://github.com/go-rod/rod) 从浏览器获取cookie. 如果无法自动获取 cookie，则使用 `dedao-dl login -c "xxxxxxxx"` 登录

`dedao-dl cat` 获取课程分类

```text
+---+----------+------+----------+
| # |   名称   |  统计 |  分类标签  |
+---+----------+------+----------+
| 0 | 全部     | 1696 | all      |
| 1 | 课程     |   64 | bauhinia |
| 2 | 听书书架  | 1407 | odob     |
| 3 | 电子书架  |  210 | ebook    |
| 4 | 锦囊      |   15 | compass  |
+---+----------+------+----------+
```

`dedao-dl course` 获取我购买过课程

```text
+----+-----+-------------------------+--------------------------------+---------------------+--------+----------+
| #  | ID  |          课程名称        |                作者             |      购买日期       |  价格  | 学习进度 |
+----+-----+-------------------------+--------------------------------+---------------------+--------+----------+
|  0 |  51 | 张潇雨·个人投资课          | 张潇雨·对冲基金管理人            | 2020-08-17 09:59:56 | 199.00 |      100 |
|  1 | 560 | 吴军·硅谷来信³（年度日更） | 吴军·计算机科学家                 | 2020-11-05 09:28:23 | 299.00 |       14 |
|  2 | 571 | 年度得到·何帆中国经济报告  | 何帆·著名经济学者                 | 2020-12-10 07:22:28 |  99.00 |       36 |
|  3 |  21 | 古典·超级个体              | 古典·资深生涯规划师             | 2019-09-23 17:11:02 | 199.00 |       84 |
|  4 |  79 | 老喻的人生算法课           | 老喻·思考者                     | 2019-09-23 17:13:51 |  99.00 |      100 |
|  5 |  84 | 给忙碌者的女性健康课       | 常青·协和医学院博士               | 2020-10-27 21:30:55 |  19.90 |      100 |
|  6 |  16 | 陈海贤·自我发展心理学      | 陈海贤·心理学博士                 | 2019-09-23 17:13:46 |  99.00 |      100 |
|  7 | 544 | 听书番外篇                | 阿狮·每天听本书负责人             | 2020-08-18 15:43:44 |   0.00 |      100 |
|  8 | 530 | 跟李松蔚学心理咨询         | 李松蔚·心理咨询师                 | 2020-07-01 11:01:44 |  99.00 |      100 |
|  9 | 484 | 王立铭·抑郁症医学课        | 王立铭·浙江大学生命科学研究院教授    | 2020-10-27 13:15:36 |  39.90 |      100 |
| 10 |  82 | 陈海贤·亲密关系30讲        | 陈海贤·心理学博士                 | 2019-11-05 00:02:21 |  99.00 |      100 |
+----+-----+-------------------------+---------------------------------+---------------------+--------+----------+
```

`dedao-dl course -i xxx` 查看课程信息

```text
专栏名称：何帆中国经济报告2019-2020
专栏作者：何帆·著名经济学者
更新进度：26/26
课程亮点：1.这份报告的关键词是“基本盘”。所谓基本盘，就是改不了、丢不掉、夺不走的东西。在黑天鹅迭出的2020年，稳住自己的基本盘，对每个人都特别重要。

2.关于这门课程，最值得你知道的是它的初心。何帆老师要用30年时间，每年写一份中国经济报告，记录中国从2019年到2049年的变化。这是他的第二份报告。加入这个课程，见证这个注定伟大的传统。

3.这门课聚焦了两个“基本盘”：中国经济的基本盘，和中国人的基本盘。何帆老师将从5大变量入手为你一一拆解：教育、组织、市场、生产和技术。

4.这门课可能和你印象中的各种“报告”不一样。何帆老师不是用理论和数据来讲这份报告，而是用故事和他生动的讲述方式来呈现报告。

5.你可以在课程中直接向何帆老师建言，哪些议题、哪些地区、哪些产业、哪些公司值得他深入研究。你的建议和观点很有可能出现在下一年的《何帆·中国经济报告》中。


+---+------+-------------------------+--------------------------------------------+---------------------+--------------+
| # |  ID  |          章节           |                  文章标题                  |      更新时间       | 是否更新完成 |
+---+------+-------------------------+--------------------------------------------+---------------------+--------------+
| 0 | 1267 | 发刊词(1讲)             | 发刊词：起风了，你选择远航，还是困在岸上？ | 2019-12-18 10:21:34 | ✔            |
| 1 | 1268 | 模块一：基本盘(4讲)     | 第1讲：怎样认知真实的中国？                | 2019-12-19 11:39:35 | ✔            |
| 1 | 1268 | 模块一：基本盘(4讲)     | 第2讲：如何找到中国经济的基本盘？          | 2019-12-19 11:39:35 | ✔            |
| 1 | 1268 | 模块一：基本盘(4讲)     | 第3讲：怎样比别人更早看到中国经济的变化？  | 2019-12-19 11:39:35 | ✔            |
| 1 | 1268 | 模块一：基本盘(4讲)     | 第4讲：如何对冲潜在的风险                  | 2019-12-19 11:39:35 | ✔            |
| 2 | 1269 | 模块二：全球化(4讲)     | 第5讲：我该怎么提高企业在供应链中的地位？  | 2019-12-27 15:59:59 | ✔            |
| 2 | 1269 | 模块二：全球化(4讲)     | 第6讲：我们怎样看待国际贸易纠纷？          | 2019-12-27 15:59:59 | ✔            |
| 2 | 1269 | 模块二：全球化(4讲)     | 第7讲：我该不该到海外投资？                | 2019-12-27 15:59:59 | ✔            |
| 2 | 1269 | 模块二：全球化(4讲)     | 第8讲：我们怎么应对全球化退潮？            | 2019-12-27 15:59:59 | ✔            |
| 3 | 1270 | 模块三：技术进步(4讲)   | 第9讲：我该如何引领企业的创新？            | 2019-12-27 16:00:02 | ✔            |
| 3 | 1270 | 模块三：技术进步(4讲)   | 第10讲：我该自力更生，还是引进技术？       | 2019-12-27 16:00:02 | ✔            |
| 3 | 1270 | 模块三：技术进步(4讲)   | 第11讲：我该怎样把技术转化为公司的产品？   | 2019-12-27 16:00:02 | ✔            |
| 3 | 1270 | 模块三：技术进步(4讲)   | 第12讲：我怎样才能做出爆款产品？           | 2019-12-27 16:00:02 | ✔            |
| 4 | 1271 | 模块四：市场演化(4讲)   | 第13讲：我该怎样找到商机？                 | 2019-12-29 00:12:30 | ✔            |
| 4 | 1271 | 模块四：市场演化(4讲)   | 第14讲：我该怎样找到苟且红利？             | 2019-12-29 00:12:30 | ✔            |
| 4 | 1271 | 模块四：市场演化(4讲)   | 第15讲：我该怎样向市场讲自己的故事？       | 2019-12-29 00:12:30 | ✔            |
| 4 | 1271 | 模块四：市场演化(4讲)   | 第16讲：我该如何做大整个产业链？           | 2019-12-29 00:12:30 | ✔            |
| 5 | 1272 | 模块五：代际变革(4讲)   | 第17讲：我该怎么管理年轻人，包括孩子？     | 2019-12-30 16:52:20 | ✔            |
| 5 | 1272 | 模块五：代际变革(4讲)   | 第18讲：我该如何利用年轻人的“缺点”？       | 2019-12-30 16:52:20 | ✔            |
| 5 | 1272 | 模块五：代际变革(4讲)   | 第19讲：我该怎样进入年轻人的圈子？         | 2019-12-30 16:52:20 | ✔            |
| 5 | 1272 | 模块五：代际变革(4讲)   | 第20讲：我该如何给自己培养接班人？         | 2019-12-30 16:52:20 | ✔            |
| 6 | 1273 | 模块六：教育(4讲)       | 第21讲：我教育孩子的理念有没有出错？       | 2020-01-02 17:56:50 | ✔            |
| 6 | 1273 | 模块六：教育(4讲)       | 第22讲：我该不该当孩子的终身陪伴者？       | 2020-01-02 17:56:50 | ✔            |
| 6 | 1273 | 模块六：教育(4讲)       | 第23讲：我该怎么办，孩子不好好学习？       | 2020-01-02 17:56:50 | ✔            |
| 6 | 1273 | 模块六：教育(4讲)       | 第24讲：我该怎样对待别人的孩子？           | 2020-01-02 17:56:50 | ✔            |
| 7 | 1274 | 模块七：总结与展望(1讲) | 第25讲：2020年一定要做的五件事             | 2020-01-02 17:56:53 | ✔            |
+---+------+-------------------------+--------------------------------------------+---------------------+--------------+
```

## References

* [geektime-dl](https://github.com/mmzou/geektime-dl)
* [annie](https://github.com/iawia002/annie)
* [m3u8](https://github.com/oopsguy/m3u8)

## Stargazers over time

[![Stargazers over time](https://starchart.cc/yann0917/dedao-dl.svg)](https://starchart.cc/yann0917/dedao-dl)

## License

[MIT](./LICENSE) © yann0917

## Support

[![jetbrains](https://s1.ax1x.com/2020/03/26/G9uQoR.png)](https://www.jetbrains.com/?from=dedao-dl)

---
